/* ===== СТИЛИ ДЛЯ ДЕТАЛЬНОГО ПРОСМОТРА МОДУЛЯ ===== */

/* Breadcrumb навигация */
.module-breadcrumb {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--color-text-secondary);
  font-size: 0.9rem;
}

.breadcrumb-separator {
  color: var(--color-text-muted);
}

/* Контейнер детального просмотра модуля */
.module-detail-container {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

/* Обзор модуля */
.module-overview {
  background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-card) 100%);
  border: 1px solid var(--color-border);
}

.module-status-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.5rem;
  gap: 1rem;
}

.module-info h1 {
  margin: 0 0 0.5rem 0;
  color: var(--color-text);
  font-size: 1.8rem;
  font-weight: 600;
}

.module-info p {
  margin: 0 0 1rem 0;
  color: var(--color-text-secondary);
  line-height: 1.6;
}

.module-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.9rem;
  color: var(--color-text-secondary);
  background: var(--color-surface);
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  border: 1px solid var(--color-border);
}

.module-status-badge {
  flex-shrink: 0;
}

.module-progress-section {
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border);
}

.progress-bar--large {
  height: 12px;
  background: var(--color-background);
  border: 1px solid var(--color-border);
}

/* Цели обучения */
.learning-objectives {
  background: var(--color-card);
}

.objectives-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.objective-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 1rem;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  transition: all 0.2s ease;
}

.objective-item:hover {
  border-color: var(--color-primary);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.objective-icon {
  font-size: 1.2rem;
  color: var(--color-primary);
  flex-shrink: 0;
  margin-top: 0.125rem;
}

.objective-text {
  color: var(--color-text);
  line-height: 1.5;
  font-weight: 500;
}

/* Структура модуля */
.module-structure {
  background: var(--color-card);
  border: 1px solid var(--color-border);
  border-radius: 12px;
  padding: 1.5rem;
}

.structure-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.structure-header h3 {
  margin: 0;
  color: var(--color-text);
}

.structure-controls {
  display: flex;
  gap: 0.5rem;
}

/* Действия с модулем */
.module-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
  padding: 2rem 0;
  border-top: 1px solid var(--color-border);
}

/* Адаптивность для мобильных устройств */
@media (max-width: 768px) {
  .module-detail-container {
    padding: 0 1rem;
  }
  
  .module-status-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .module-meta {
    justify-content: space-between;
  }
  
  .structure-header {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }
  
  .structure-controls {
    justify-content: center;
  }
  
  .objectives-grid {
    grid-template-columns: 1fr;
  }
  
  .module-actions {
    flex-direction: column;
  }
}

/* Действия с модулем */
.module-actions .btn {
  margin-right: var(--space-12);
  margin-bottom: var(--space-12);
}

/* Адаптивность для модулей */
@media (max-width: 768px) {
  .module-detail-container {
    padding: var(--space-16);
  }
  
  .module-actions {
    display: flex;
    flex-direction: column;
  }
  
  .module-actions .btn {
    margin-right: 0;
    margin-bottom: var(--space-8);
  }
}

/* ===== СТИЛИ ДЛЯ ИЗУЧЕНИЯ МОДУЛЯ ===== */

/* Общий контейнер страницы изучения */
.container-fluid {
  width: 100%;
  max-width: none;
  padding: 0;
}

/* Макет страницы изучения модуля */
.module-learning-layout {
  display: grid;
  grid-template-columns: 320px 1fr;
  min-height: 100vh;
  background: var(--color-background);
}

/* Боковая панель модуля */
.module-sidebar {
  background: var(--color-surface);
  border-right: 1px solid var(--color-border);
  padding: var(--space-24);
  overflow-y: auto;
}

.module-info-card {
  position: sticky;
  top: var(--space-24);
}

.module-breadcrumb {
  margin-bottom: var(--space-24);
}

.breadcrumb-path {
  margin-top: var(--space-8);
  font-size: 0.85rem;
  color: var(--color-text-secondary);
}

.breadcrumb-separator {
  margin: 0 var(--space-8);
  color: var(--color-border);
}

.module-learning-info {
  margin-bottom: var(--space-32);
}

.module-learning-info h3 {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-text);
  font-size: 1.2rem;
}

.module-learning-info p {
  margin: 0 0 var(--space-16) 0;
  color: var(--color-text-secondary);
  line-height: 1.5;
}

.learning-progress {
  margin-top: var(--space-16);
}

.learning-actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

/* Основная область изучения */
.module-learning-main {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Вкладки */
.learning-tabs {
  display: flex;
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: 0 var(--space-24);
}

.tab-button {
  background: none;
  border: none;
  padding: var(--space-16) var(--space-20);
  font-size: 0.95rem;
  color: var(--color-text-secondary);
  cursor: pointer;
  border-bottom: 3px solid transparent;
  transition: all 0.2s ease;
  position: relative;
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.tab-button:hover {
  color: var(--color-text);
  background: var(--color-background);
}

.tab-button.active {
  color: var(--color-primary);
  border-bottom-color: var(--color-primary);
}

.chat-indicator {
  width: 8px;
  height: 8px;
  background: var(--color-success);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

/* Контент вкладок */
.learning-tab-content {
  flex: 1;
  display: none;
  overflow: hidden;
}

.learning-tab-content.active {
  display: flex;
  flex-direction: column;
}

/* Конспект модуля */
.conspect-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--space-24);
}

.conspect-header {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: var(--space-24);
  padding-bottom: var(--space-16);
  border-bottom: 1px solid var(--color-border);
}

.conspect-header h2 {
  margin: 0;
  color: var(--color-text);
  font-size: 1.3rem;
}

.conspect-actions {
  display: flex;
  gap: var(--space-8);
}

.conspect-content {
  flex: 1;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-8);
  padding: var(--space-24);
  overflow-y: auto;
  line-height: 1.6;
}

/* Загрузка конспекта */
.conspect-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 200px;
  color: var(--color-text-secondary);
}

.conspect-loading .loading-spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--color-border);
  border-top: 3px solid var(--color-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: var(--space-16);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Форматирование markdown конспекта */
.conspect-content h1,
.conspect-content h2,
.conspect-content h3,
.conspect-content h4 {
  color: var(--color-text);
  margin-top: var(--space-24);
  margin-bottom: var(--space-12);
}

.conspect-content h1 {
  font-size: 1.8rem;
  border-bottom: 2px solid var(--color-primary);
  padding-bottom: var(--space-8);
}

.conspect-content h2 {
  font-size: 1.5rem;
  color: var(--color-primary);
}

.conspect-content h3 {
  font-size: 1.2rem;
}

.conspect-content ul,
.conspect-content ol {
  margin: var(--space-16) 0;
  padding-left: var(--space-24);
}

.conspect-content li {
  margin-bottom: var(--space-8);
}

.conspect-content code {
  background: var(--color-background);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.9em;
}

.conspect-content pre {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-8);
  padding: var(--space-16);
  overflow-x: auto;
  margin: var(--space-16) 0;
}

.conspect-content blockquote {
  border-left: 4px solid var(--color-primary);
  padding-left: var(--space-16);
  margin: var(--space-16) 0;
  font-style: italic;
  color: var(--color-text-secondary);
}

/* Чат модуля */
.learning-chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.learning-chat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-24);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-surface);
}

.learning-chat-header h2 {
  margin: 0;
  color: var(--color-text);
  font-size: 1.3rem;
}

.chat-status {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  font-size: 0.9rem;
  color: var(--color-text-secondary);
}

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.status-indicator.online {
  background: var(--color-success);
}

/* Сообщения чата модуля */
.module-chat-messages {
  flex: 1;
  padding: var(--space-24);
  overflow-y: auto;
  background: var(--color-background);
}

.module-chat-message {
  margin-bottom: var(--space-16);
  animation: none !important;
  transform: none !important;
}

.module-chat-message.user {
  text-align: right;
}

.module-chat-message.ai {
  text-align: left;
}

.module-chat-message .message-content {
  padding: var(--space-12);
  border-radius: var(--border-radius-md);
  line-height: 1.5;
  animation: none !important;
  transform: none !important;
}

.module-chat-message.user .message-content {
  background: var(--color-primary);
  color: white;
  border-bottom-right-radius: var(--radius-4);
}

.module-chat-message.ai .message-content {
  background: var(--color-surface);
  color: var(--color-text);
  border: 1px solid var(--color-border);
  border-bottom-left-radius: var(--radius-4);
}

.module-chat-message .message-meta {
  margin-top: var(--space-4);
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

/* Ввод сообщения */
.module-chat-input {
  background: var(--color-surface);
  border-top: 1px solid var(--color-border);
  padding: var(--space-16) var(--space-24);
}

.chat-input-container {
  display: flex;
  gap: var(--space-12);
  align-items: flex-end;
  margin-bottom: var(--space-12);
}

.chat-input-container textarea {
  flex: 1;
  resize: none;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-8);
  padding: var(--space-12);
  font-family: inherit;
  font-size: 0.95rem;
  line-height: 1.4;
  max-height: 120px;
}

.chat-input-container textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-primary-light);
}

.chat-input-container button {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  white-space: nowrap;
}

/* Подсказки чата */
.chat-hints {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
}

.hint-item {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-16);
  padding: var(--space-4) var(--space-12);
  font-size: 0.85rem;
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.2s ease;
}

.hint-item:hover {
  background: var(--color-primary-light);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

/* Адаптивность */
@media (max-width: 1024px) {
  .module-learning-layout {
    grid-template-columns: 280px 1fr;
  }
  
  .module-sidebar {
    padding: var(--space-16);
  }
}

@media (max-width: 768px) {
  .module-learning-layout {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
  }
  
  .module-sidebar {
    border-right: none;
    border-bottom: 1px solid var(--color-border);
    padding: var(--space-16);
  }
  
  .module-info-card {
    position: static;
  }
  
  .learning-actions {
    flex-direction: row;
  }
  
  .conspect-container,
  .learning-chat-header,
  .module-chat-input {
    padding: var(--space-16);
  }
  
  .chat-hints {
    display: none;
  }
}

/* Полноэкранный режим конспекта */
.conspect-container.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1000;
  background: var(--color-surface);
  padding: var(--space-24);
}

.conspect-container.fullscreen .conspect-header {
  position: sticky;
  top: 0;
  background: var(--color-surface);
  z-index: 1001;
}

.conspect-container.fullscreen .conspect-content {
  max-width: 800px;
  margin: 0 auto;
  font-size: 1.1rem;
  line-height: 1.8;
}

/* Стили для сообщений с ошибками */
.module-chat-message.error .message-content {
  background: var(--color-error-light);
  border-color: var(--color-error);
  color: var(--color-error);
}

.module-chat-message.loading .message-content {
  background: var(--color-background);
  border: 1px dashed var(--color-border);
  color: var(--color-text-secondary);
  font-style: italic;
  padding: var(--space-16);
  animation: none !important;
  transform: none !important;
}

.module-chat-message.conspect .message-content {
  background: var(--color-primary-light);
  border-color: var(--color-primary);
  border-width: 2px;
}

/* Стили для markdown контента */
.markdown-content {
  font-family: inherit;
  line-height: 1.7;
}

.markdown-content h1 {
  font-size: 1.8rem;
  font-weight: 600;
  margin: var(--space-32) 0 var(--space-16) 0;
  color: var(--color-text);
  border-bottom: 2px solid var(--color-primary);
  padding-bottom: var(--space-8);
}

.markdown-content h2 {
  font-size: 1.5rem;
  font-weight: 600;
  margin: var(--space-24) 0 var(--space-12) 0;
  color: var(--color-primary);
}

.markdown-content h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin: var(--space-20) 0 var(--space-10) 0;
  color: var(--color-text);
}

.markdown-content p {
  margin: var(--space-12) 0;
  color: var(--color-text);
}

.markdown-content ul, 
.markdown-content ol {
  margin: var(--space-16) 0;
  padding-left: var(--space-24);
}

.markdown-content li {
  margin: var(--space-8) 0;
  color: var(--color-text);
}

.markdown-content strong {
  font-weight: 600;
  color: var(--color-text);
}

.markdown-content em {
  font-style: italic;
  color: var(--color-text-secondary);
}

.markdown-content code {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  padding: 2px 6px;
  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
  font-size: 0.9em;
  color: var(--color-text);
}

.markdown-content pre {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-8);
  padding: var(--space-16);
  overflow-x: auto;
  margin: var(--space-16) 0;
}

.markdown-content pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: 0.95em;
}

.markdown-content blockquote {
  border-left: 4px solid var(--color-primary);
  background: var(--color-background);
  padding: var(--space-12) var(--space-16);
  margin: var(--space-16) 0;
  font-style: italic;
  color: var(--color-text-secondary);
}

.markdown-content table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--space-16) 0;
}

.markdown-content th,
.markdown-content td {
  border: 1px solid var(--color-border);
  padding: var(--space-8) var(--space-12);
  text-align: left;
}

.markdown-content th {
  background: var(--color-background);
  font-weight: 600;
  color: var(--color-text);
}

.markdown-content td {
  color: var(--color-text);
}

/* Улучшенная анимация ИИ загрузки */
.ai-thinking-container {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-8) 0;
  animation: none;
  transform: none;
}

.thinking-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--color-border);
  border-top: 2px solid var(--color-primary);
  border-radius: 50%;
  animation: thinking-spin 1s linear infinite;
  flex-shrink: 0;
  transform-origin: center;
}

.thinking-text {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  animation: none;
  transform: none;
}

.thinking-text span {
  font-size: 0.95rem;
  color: var(--color-text-secondary);
  font-weight: 500;
}

.thinking-dots {
  display: flex;
  gap: 4px;
  justify-content: flex-start;
}

.thinking-dots .dot {
  width: 4px;
  height: 4px;
  background-color: var(--color-text-secondary);
  border-radius: 50%;
  animation: thinking-pulse 1.4s ease-in-out infinite both;
}

.thinking-dots .dot:nth-child(1) { animation-delay: -0.32s; }
.thinking-dots .dot:nth-child(2) { animation-delay: -0.16s; }
.thinking-dots .dot:nth-child(3) { animation-delay: 0s; }

@keyframes thinking-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes thinking-pulse {
  0%, 60%, 100% { 
    opacity: 0.3;
    transform: scale(1);
  }
  30% { 
    opacity: 1;
    transform: scale(1.2);
  }
}

/* Маленький спиннер для кнопки отправки */
button .thinking-spinner {
  width: 12px;
  height: 12px;
  border-width: 1.5px;
  margin-right: 6px;
  display: inline-block;
  vertical-align: middle;
}

/* Улучшенное отображение ошибок */
.ai-error-container {
  display: flex;
  align-items: flex-start;
  gap: var(--space-12);
  padding: var(--space-8) 0;
}

.error-icon {
  font-size: 1.2rem;
  flex-shrink: 0;
  margin-top: 2px;
}

.error-text {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.error-title {
  font-weight: 600;
  color: var(--color-error);
  font-size: 0.95rem;
}

.error-details {
  color: var(--color-text);
  font-size: 0.9rem;
  line-height: 1.4;
}

.error-hint {
  color: var(--color-text-secondary);
  font-size: 0.85rem;
  font-style: italic;
}

/* Более специфичный селектор для спиннера в сообщениях чата */
.module-chat-message .ai-thinking-container .thinking-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--color-border, #e2e8f0);
  border-top: 2px solid var(--color-primary, #3b82f6);
  border-radius: 50%;
  animation: thinking-spin 1s linear infinite;
  flex-shrink: 0;
  transform-origin: center;
  /* Убеждаемся что это единственный элемент с анимацией вращения */
  position: relative;
  z-index: 1;
}

/* Убеждаемся что контейнер ИИ не вращается */
.module-chat-message .ai-thinking-container {
  display: flex;
  align-items: center;
  gap: var(--space-12, 12px);
  padding: var(--space-8, 8px) 0;
  animation: none !important;
  transform: none !important;
  position: relative;
}

/* Убеждаемся что текст не вращается */
.module-chat-message .ai-thinking-container .thinking-text {
  display: flex;
  flex-direction: column;
  gap: var(--space-4, 4px);
  animation: none !important;
  transform: none !important;
}

/* Специфичная анимация только для спиннера */
@keyframes thinking-spin {
  from { 
    transform: rotate(0deg); 
  }
  to { 
    transform: rotate(360deg); 
  }
}

/* CSS сброс анимаций для предотвращения нежелательного вращения */
.module-chat-message *:not(.thinking-spinner) {
  animation: none !important;
  transform: none !important;
}

/* Исключение только для спиннера - разрешаем ему вращаться */
.module-chat-message .thinking-spinner {
  animation: thinking-spin 1s linear infinite !important;
}

/* Дополнительные меры предосторожности */
.module-chat-message .message-content *:not(.thinking-spinner) {
  animation: none !important;
  transform: none !important;
} 